============================= test session starts ==============================
platform linux -- Python 3.12.12, pytest-8.4.2, pluggy-1.6.0 -- /home/strokmatic/.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/bin/python
cachedir: .pytest_cache
rootdir: /home/strokmatic/Desktop/DataScience/Fast_Zero
configfile: pyproject.toml
plugins: cov-7.0.0, anyio-4.11.0
collecting ... collected 8 items

tests/test_app.py::test_read_root_deve_retornar_ok_e_ola_mundo PASSED    [ 12%]
tests/test_app.py::test_read_users_when_db_is_empty FAILED               [ 25%]
tests/test_app.py::test_read_users_when_db_contains_data FAILED          [ 37%]
tests/test_app.py::test_create_user FAILED                               [ 50%]
tests/test_app.py::test_update_user FAILED                               [ 62%]
tests/test_app.py::test_delete_user FAILED                               [ 75%]
tests/test_app.py::test_update_integrity_error FAILED                    [ 87%]
tests/test_db.py::test_create_user FAILED                                [100%]

=================================== FAILURES ===================================
_______________________ test_read_users_when_db_is_empty _______________________

self = <sqlalchemy.engine.base.Connection object at 0x787cb9fd2090>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x787cba17f4d0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x787cb9fd2390>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x787cb9fd2240>
parameters = [(10, 0)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x787cba17f4d0>
cursor = <sqlite3.Cursor object at 0x787cba0041c0>
statement = 'SELECT users.id, users.username, users.email, users.password, users.created_at, users.updated_at \nFROM users\n LIMIT ? OFFSET ?'
parameters = (10, 0)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x787cb9fd2390>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such table: users

../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x787cb9f8f710>

    def test_read_users_when_db_is_empty(client):
>       reponse = client.get('/users/')
                  ^^^^^^^^^^^^^^^^^^^^^

tests/test_app.py:14: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/testclient.py:479: in get
    return super().get(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/httpx/_client.py:1053: in get
    return self.request(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/testclient.py:451: in request
    return super().request(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/httpx/_client.py:825: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/httpx/_client.py:914: in send
    response = self._send_handling_auth(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth
    response = self._send_handling_redirects(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects
    response = self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/httpx/_client.py:1014: in _send_single_request
    response = transport.handle_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request
    raise exc
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request
    portal.call(self.app, scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/anyio/from_thread.py:321: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.pyenv/versions/3.12.12/lib/python3.12/concurrent/futures/_base.py:456: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
../../../.pyenv/versions/3.12.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result
    raise self._exception
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/fastapi/applications.py:1133: in __call__
    await super().__call__(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/fastapi/routing.py:123: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/fastapi/routing.py:109: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/fastapi/routing.py:389: in app
    raw_response = await run_endpoint_function(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/fastapi/routing.py:290: in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/anyio/to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
src/fast_zero/app.py:28: in read_users
    users = session.scalars(select(User).limit(limit).offset(offset))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2459: in scalars
    return self._execute_internal(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x787cba17f4d0>
cursor = <sqlite3.Cursor object at 0x787cba0041c0>
statement = 'SELECT users.id, users.username, users.email, users.password, users.created_at, users.updated_at \nFROM users\n LIMIT ? OFFSET ?'
parameters = (10, 0)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x787cb9fd2390>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
E       [SQL: SELECT users.id, users.username, users.email, users.password, users.created_at, users.updated_at 
E       FROM users
E        LIMIT ? OFFSET ?]
E       [parameters: (10, 0)]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: OperationalError
____________________ test_read_users_when_db_contains_data _____________________

self = <sqlalchemy.engine.base.Connection object at 0x787cb9fd2180>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x787cba17f4d0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x787cb9f49010>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x787cb9fd2240>
parameters = [(10, 0)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x787cba17f4d0>
cursor = <sqlite3.Cursor object at 0x787cba101340>
statement = 'SELECT users.id, users.username, users.email, users.password, users.created_at, users.updated_at \nFROM users\n LIMIT ? OFFSET ?'
parameters = (10, 0)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x787cb9f49010>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such table: users

../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x787cb9fd0e00>
user = User(id=1, username='test_user', email='test_email@test.com', password='any_password', created_at=datetime.datetime(2025, 11, 5, 13, 58), updated_at=datetime.datetime(2025, 11, 5, 13, 58))

    def test_read_users_when_db_contains_data(client, user):
    
        user_schema = UserPublic.model_validate(user).model_dump()
>       response = client.get('/users/')
                   ^^^^^^^^^^^^^^^^^^^^^

tests/test_app.py:23: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/testclient.py:479: in get
    return super().get(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/httpx/_client.py:1053: in get
    return self.request(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/testclient.py:451: in request
    return super().request(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/httpx/_client.py:825: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/httpx/_client.py:914: in send
    response = self._send_handling_auth(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth
    response = self._send_handling_redirects(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects
    response = self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/httpx/_client.py:1014: in _send_single_request
    response = transport.handle_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request
    raise exc
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request
    portal.call(self.app, scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/anyio/from_thread.py:321: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.pyenv/versions/3.12.12/lib/python3.12/concurrent/futures/_base.py:456: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
../../../.pyenv/versions/3.12.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result
    raise self._exception
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/fastapi/applications.py:1133: in __call__
    await super().__call__(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/fastapi/routing.py:123: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/fastapi/routing.py:109: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/fastapi/routing.py:389: in app
    raw_response = await run_endpoint_function(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/fastapi/routing.py:290: in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/anyio/to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
src/fast_zero/app.py:28: in read_users
    users = session.scalars(select(User).limit(limit).offset(offset))
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2459: in scalars
    return self._execute_internal(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x787cba17f4d0>
cursor = <sqlite3.Cursor object at 0x787cba101340>
statement = 'SELECT users.id, users.username, users.email, users.password, users.created_at, users.updated_at \nFROM users\n LIMIT ? OFFSET ?'
parameters = (10, 0)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x787cb9f49010>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
E       [SQL: SELECT users.id, users.username, users.email, users.password, users.created_at, users.updated_at 
E       FROM users
E        LIMIT ? OFFSET ?]
E       [parameters: (10, 0)]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: OperationalError
_______________________________ test_create_user _______________________________

self = <sqlalchemy.engine.base.Connection object at 0x787cb3dba600>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x787cba17f4d0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x787cb3dbaf30>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x787cb3dba840>
parameters = [('alice', 'test@gmail.com')]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x787cba17f4d0>
cursor = <sqlite3.Cursor object at 0x787cb9f7f440>
statement = 'SELECT users.id, users.username, users.email, users.password, users.created_at, users.updated_at \nFROM users \nWHERE users.username = ? OR users.email = ?'
parameters = ('alice', 'test@gmail.com')
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x787cb3dbaf30>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such table: users

../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x787cb8e99d30>
mock_db_time = <function _mock_db_time at 0x787cba065800>

    def test_create_user(client, mock_db_time):
    
        # Test variables
        username = 'alice'
        email = 'test@gmail.com'
        password = 'password'
    
>       response = client.post(
            '/users/',
            json={'username': username, 'email': email, 'password': password},
        )

tests/test_app.py:37: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/testclient.py:552: in post
    return super().post(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/httpx/_client.py:1144: in post
    return self.request(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/testclient.py:451: in request
    return super().request(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/httpx/_client.py:825: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/httpx/_client.py:914: in send
    response = self._send_handling_auth(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth
    response = self._send_handling_redirects(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects
    response = self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/httpx/_client.py:1014: in _send_single_request
    response = transport.handle_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request
    raise exc
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request
    portal.call(self.app, scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/anyio/from_thread.py:321: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.pyenv/versions/3.12.12/lib/python3.12/concurrent/futures/_base.py:456: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
../../../.pyenv/versions/3.12.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result
    raise self._exception
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/fastapi/applications.py:1133: in __call__
    await super().__call__(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/fastapi/routing.py:123: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/fastapi/routing.py:109: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/fastapi/routing.py:389: in app
    raw_response = await run_endpoint_function(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/fastapi/routing.py:290: in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/anyio/to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
src/fast_zero/app.py:44: in create_user
    db_user = session.scalar(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2399: in scalar
    return self._execute_internal(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x787cba17f4d0>
cursor = <sqlite3.Cursor object at 0x787cb9f7f440>
statement = 'SELECT users.id, users.username, users.email, users.password, users.created_at, users.updated_at \nFROM users \nWHERE users.username = ? OR users.email = ?'
parameters = ('alice', 'test@gmail.com')
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x787cb3dbaf30>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
E       [SQL: SELECT users.id, users.username, users.email, users.password, users.created_at, users.updated_at 
E       FROM users 
E       WHERE users.username = ? OR users.email = ?]
E       [parameters: ('alice', 'test@gmail.com')]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: OperationalError
_______________________________ test_update_user _______________________________

self = <sqlalchemy.engine.base.Connection object at 0x787cb89bcd70>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x787cba17f4d0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x787cb89bcf80>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x787cb3dba840>
parameters = [('testusername', 'test@test.com')]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x787cba17f4d0>
cursor = <sqlite3.Cursor object at 0x787cb3a81340>
statement = 'SELECT users.id, users.username, users.email, users.password, users.created_at, users.updated_at \nFROM users \nWHERE users.username = ? OR users.email = ?'
parameters = ('testusername', 'test@test.com')
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x787cb89bcf80>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such table: users

../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x787cb3dad850>
user = User(id=1, username='test_user', email='test_email@test.com', password='any_password', created_at=datetime.datetime(2025, 11, 5, 13, 58, 2), updated_at=datetime.datetime(2025, 11, 5, 13, 58, 2))

    def test_update_user(client, user):
        # Arrange: Create a user to be updated.
>       client.post(
            '/users/',
            json={
                'username': 'testusername',
                'password': 'password',
                'email': 'test@test.com',
            },
        )

tests/test_app.py:54: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/testclient.py:552: in post
    return super().post(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/httpx/_client.py:1144: in post
    return self.request(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/testclient.py:451: in request
    return super().request(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/httpx/_client.py:825: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/httpx/_client.py:914: in send
    response = self._send_handling_auth(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth
    response = self._send_handling_redirects(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects
    response = self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/httpx/_client.py:1014: in _send_single_request
    response = transport.handle_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request
    raise exc
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request
    portal.call(self.app, scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/anyio/from_thread.py:321: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.pyenv/versions/3.12.12/lib/python3.12/concurrent/futures/_base.py:456: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
../../../.pyenv/versions/3.12.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result
    raise self._exception
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/fastapi/applications.py:1133: in __call__
    await super().__call__(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/fastapi/routing.py:123: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/fastapi/routing.py:109: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/fastapi/routing.py:389: in app
    raw_response = await run_endpoint_function(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/fastapi/routing.py:290: in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/anyio/to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
src/fast_zero/app.py:44: in create_user
    db_user = session.scalar(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2399: in scalar
    return self._execute_internal(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x787cba17f4d0>
cursor = <sqlite3.Cursor object at 0x787cb3a81340>
statement = 'SELECT users.id, users.username, users.email, users.password, users.created_at, users.updated_at \nFROM users \nWHERE users.username = ? OR users.email = ?'
parameters = ('testusername', 'test@test.com')
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x787cb89bcf80>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
E       [SQL: SELECT users.id, users.username, users.email, users.password, users.created_at, users.updated_at 
E       FROM users 
E       WHERE users.username = ? OR users.email = ?]
E       [parameters: ('testusername', 'test@test.com')]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: OperationalError
_______________________________ test_delete_user _______________________________

client = <starlette.testclient.TestClient object at 0x787cb3dac920>
user = User(id=1, username='test_user', email='test_email@test.com', password='any_password', created_at=datetime.datetime(2025, 11, 5, 13, 58, 2), updated_at=datetime.datetime(2025, 11, 5, 13, 58, 2))

    def test_delete_user(client, user):
    
        response = client.delete('/users/1')
    
        # Assert
>       assert response.status_code == HTTPStatus.OK
E       assert 422 == <HTTPStatus.OK: 200>
E        +  where 422 = <Response [422 Unprocessable Entity]>.status_code
E        +  and   <HTTPStatus.OK: 200> = HTTPStatus.OK

tests/test_app.py:87: AssertionError
_________________________ test_update_integrity_error __________________________

self = <sqlalchemy.engine.base.Connection object at 0x787cb89a1d90>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x787cba17f4d0>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x787cb89a1f70>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x787cb3dba840>
parameters = [('conflict_user', 'conflict_user@email.com')]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x787cba17f4d0>
cursor = <sqlite3.Cursor object at 0x787cb8570840>
statement = 'SELECT users.id, users.username, users.email, users.password, users.created_at, users.updated_at \nFROM users \nWHERE users.username = ? OR users.email = ?'
parameters = ('conflict_user', 'conflict_user@email.com')
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x787cb89a1f70>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such table: users

../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: OperationalError

The above exception was the direct cause of the following exception:

client = <starlette.testclient.TestClient object at 0x787cb89c30e0>
user = User(id=1, username='test_user', email='test_email@test.com', password='any_password', created_at=datetime.datetime(2025, 11, 5, 13, 58, 2), updated_at=datetime.datetime(2025, 11, 5, 13, 58, 2))

    def test_update_integrity_error(client, user):
    
        # Create new user
>       client.post('/users/',
                    json={
                        'username': 'conflict_user',
                        'email': 'conflict_user@email.com',
                        'password': 'password'
                        }
                    )

tests/test_app.py:95: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/testclient.py:552: in post
    return super().post(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/httpx/_client.py:1144: in post
    return self.request(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/testclient.py:451: in request
    return super().request(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/httpx/_client.py:825: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/httpx/_client.py:914: in send
    response = self._send_handling_auth(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/httpx/_client.py:942: in _send_handling_auth
    response = self._send_handling_redirects(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/httpx/_client.py:979: in _send_handling_redirects
    response = self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/httpx/_client.py:1014: in _send_single_request
    response = transport.handle_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/testclient.py:354: in handle_request
    raise exc
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/testclient.py:351: in handle_request
    portal.call(self.app, scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/anyio/from_thread.py:321: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.pyenv/versions/3.12.12/lib/python3.12/concurrent/futures/_base.py:456: in result
    return self.__get_result()
           ^^^^^^^^^^^^^^^^^^^
../../../.pyenv/versions/3.12.12/lib/python3.12/concurrent/futures/_base.py:401: in __get_result
    raise self._exception
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/anyio/from_thread.py:252: in _call_func
    retval = await retval_or_awaitable
             ^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/fastapi/applications.py:1133: in __call__
    await super().__call__(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/applications.py:113: in __call__
    await self.middleware_stack(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/middleware/errors.py:186: in __call__
    raise exc
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/middleware/errors.py:164: in __call__
    await self.app(scope, receive, _send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/middleware/exceptions.py:63: in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py:18: in __call__
    await self.app(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/routing.py:716: in __call__
    await self.middleware_stack(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/routing.py:736: in app
    await route.handle(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/routing.py:290: in handle
    await self.app(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/fastapi/routing.py:123: in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/_exception_handler.py:53: in wrapped_app
    raise exc
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/_exception_handler.py:42: in wrapped_app
    await app(scope, receive, sender)
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/fastapi/routing.py:109: in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/fastapi/routing.py:389: in app
    raw_response = await run_endpoint_function(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/fastapi/routing.py:290: in run_endpoint_function
    return await run_in_threadpool(dependant.call, **values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/starlette/concurrency.py:38: in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/anyio/to_thread.py:56: in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:2485: in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/anyio/_backends/_asyncio.py:976: in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
src/fast_zero/app.py:44: in create_user
    db_user = session.scalar(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2399: in scalar
    return self._execute_internal(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/orm/session.py:2249: in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/orm/context.py:306: in orm_execute_statement
    result = conn.execute(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1419: in execute
    return meth(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/sql/elements.py:526: in _execute_on_connection
    return connection._execute_clauseelement(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1641: in _execute_clauseelement
    ret = self._execute_context(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1846: in _execute_context
    return self._exec_single_context(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1986: in _exec_single_context
    self._handle_dbapi_exception(
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:2355: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/base.py:1967: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x787cba17f4d0>
cursor = <sqlite3.Cursor object at 0x787cb8570840>
statement = 'SELECT users.id, users.username, users.email, users.password, users.created_at, users.updated_at \nFROM users \nWHERE users.username = ? OR users.email = ?'
parameters = ('conflict_user', 'conflict_user@email.com')
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x787cb89a1f70>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
E       [SQL: SELECT users.id, users.username, users.email, users.password, users.created_at, users.updated_at 
E       FROM users 
E       WHERE users.username = ? OR users.email = ?]
E       [parameters: ('conflict_user', 'conflict_user@email.com')]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

../../../.cache/pypoetry/virtualenvs/fast-zero-qfLqZlUZ-py3.12/lib/python3.12/site-packages/sqlalchemy/engine/default.py:951: OperationalError
_______________________________ test_create_user _______________________________

session = <sqlalchemy.orm.session.Session object at 0x787cb89c3e30>
mock_db_time = <function _mock_db_time at 0x787cba065800>

    def test_create_user(session, mock_db_time):
        with mock_db_time(model=User) as time:
            new_user = User(
                username='testuser',
                email='test@test.com',
                password='securepassword',
            )
    
            session.add(new_user)
            session.commit()
    
            # Scalar method to convert database metadata to python
            user = session.scalar(select(User).where(User.username == 'testuser'))
    
>           assert asdict(user) == {
                'id': 1,
                'username': 'testuser',
                'email': 'test@test.com',
                'password': 'securepassword',
                'created_at': time,
            }
E           AssertionError: assert {'id': 1, 'username': 'testuser', 'email': 'test@test.com', 'password': 'securepassword', 'created_at': datetime.datetime(2025, 11, 5, 10, 57, 59, 746706), 'updated_at': datetime.datetime(2025, 11, 5, 10, 57, 59, 746706)} == {'id': 1, 'username': 'testuser', 'email': 'test@test.com', 'password': 'securepassword', 'created_at': datetime.datetime(2025, 11, 5, 10, 57, 59, 746706)}
E             
E             Common items:
E             {'created_at': datetime.datetime(2025, 11, 5, 10, 57, 59, 746706),
E              'email': 'test@test.com',
E              'id': 1,
E              'password': 'securepassword',
E              'username': 'testuser'}
E             Left contains 1 more item:
E             {'updated_at': datetime.datetime(2025, 11, 5, 10, 57, 59, 746706)}
E             
E             Full diff:
E               {
E                   'created_at': datetime.datetime(2025, 11, 5, 10, 57, 59, 746706),
E                   'email': 'test@test.com',
E                   'id': 1,
E                   'password': 'securepassword',
E             +     'updated_at': datetime.datetime(2025, 11, 5, 10, 57, 59, 746706),
E                   'username': 'testuser',
E               }

tests/test_db.py:22: AssertionError
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.12-final-0 _______________

Name                         Stmts   Miss  Cover
------------------------------------------------
src/fast_zero/__init__.py        0      0   100%
src/fast_zero/app.py            55     31    44%
src/fast_zero/database.py       13      2    85%
src/fast_zero/db_models.py      13      0   100%
src/fast_zero/schemas.py        16      0   100%
src/fast_zero/settings.py        4      0   100%
------------------------------------------------
TOTAL                          101     33    67%
=========================== short test summary info ============================
FAILED tests/test_app.py::test_read_users_when_db_is_empty - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
[SQL: SELECT users.id, users.username, users.email, users.password, users.created_at, users.updated_at 
FROM users
 LIMIT ? OFFSET ?]
[parameters: (10, 0)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
FAILED tests/test_app.py::test_read_users_when_db_contains_data - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
[SQL: SELECT users.id, users.username, users.email, users.password, users.created_at, users.updated_at 
FROM users
 LIMIT ? OFFSET ?]
[parameters: (10, 0)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
FAILED tests/test_app.py::test_create_user - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
[SQL: SELECT users.id, users.username, users.email, users.password, users.created_at, users.updated_at 
FROM users 
WHERE users.username = ? OR users.email = ?]
[parameters: ('alice', 'test@gmail.com')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
FAILED tests/test_app.py::test_update_user - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
[SQL: SELECT users.id, users.username, users.email, users.password, users.created_at, users.updated_at 
FROM users 
WHERE users.username = ? OR users.email = ?]
[parameters: ('testusername', 'test@test.com')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
FAILED tests/test_app.py::test_delete_user - assert 422 == <HTTPStatus.OK: 200>
 +  where 422 = <Response [422 Unprocessable Entity]>.status_code
 +  and   <HTTPStatus.OK: 200> = HTTPStatus.OK
FAILED tests/test_app.py::test_update_integrity_error - sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
[SQL: SELECT users.id, users.username, users.email, users.password, users.created_at, users.updated_at 
FROM users 
WHERE users.username = ? OR users.email = ?]
[parameters: ('conflict_user', 'conflict_user@email.com')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
FAILED tests/test_db.py::test_create_user - AssertionError: assert {'id': 1, 'username': 'testuser', 'email': 'test@test.com', 'password': 'securepassword', 'created_at': datetime.datetime(2025, 11, 5, 10, 57, 59, 746706), 'updated_at': datetime.datetime(2025, 11, 5, 10, 57, 59, 746706)} == {'id': 1, 'username': 'testuser', 'email': 'test@test.com', 'password': 'securepassword', 'created_at': datetime.datetime(2025, 11, 5, 10, 57, 59, 746706)}
  
  Common items:
  {'created_at': datetime.datetime(2025, 11, 5, 10, 57, 59, 746706),
   'email': 'test@test.com',
   'id': 1,
   'password': 'securepassword',
   'username': 'testuser'}
  Left contains 1 more item:
  {'updated_at': datetime.datetime(2025, 11, 5, 10, 57, 59, 746706)}
  
  Full diff:
    {
        'created_at': datetime.datetime(2025, 11, 5, 10, 57, 59, 746706),
        'email': 'test@test.com',
        'id': 1,
        'password': 'securepassword',
  +     'updated_at': datetime.datetime(2025, 11, 5, 10, 57, 59, 746706),
        'username': 'testuser',
    }
========================= 7 failed, 1 passed in 3.76s ==========================
